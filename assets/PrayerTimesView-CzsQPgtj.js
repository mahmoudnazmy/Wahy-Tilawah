import{_ as G,r as h,o as K,q as W,a as v,b as s,i as P,t as g,m as b,w as L,v as X,x as Z,j as $,F as R,d as B,f}from"./index-BtZz1Nt2.js";import{a as F}from"./index-DW_MHI2K.js";const ee="https://api.aladhan.com/v1",te="https://nominatim.openstreetmap.org",ae=F.create({baseURL:ee,timeout:1e4}),T={gregorian:new Date("2025-02-01"),hijri:{day:2,month:8,year:1446}},_={async getPrayerTimesByCoordinates(r,n){var i,u,l;try{const o=Math.floor(Date.now()/1e3),c=await ae.get(`/timings/${o}`,{params:{latitude:r,longitude:n,method:4,school:1,adjustment:1}});if(((i=c.data)==null?void 0:i.code)===200&&((l=(u=c.data)==null?void 0:u.data)!=null&&l.timings))return{timings:c.data.data.timings,date:c.data.data.date,meta:c.data.data.meta};throw new Error("فشل في جلب مواقيت الصلاة")}catch(o){throw console.error("خطأ في جلب مواقيت الصلاة:",o),o}},async searchCities(r){try{return(await F.get(`${te}/search`,{params:{q:r,format:"json","accept-language":"ar",countrycodes:"sa,ae,eg,kw,bh,om,qa,iq,sy,lb,jo,ps,ye",limit:10,featuretype:"city"},headers:{"Accept-Language":"ar"}})).data.map(i=>{var c,d,p;const u=((c=i.display_name)==null?void 0:c.split(","))||[],l=u[0]||"",o=u[u.length-1]||"";return{name:`${l}${o?` - ${o.trim()}`:""}`,lat:i.lat,lon:i.lon,country:((p=(d=i.address)==null?void 0:d.country_code)==null?void 0:p.toUpperCase())||"",type:"city"}}).filter(i=>i.name&&i.lat&&i.lon)}catch(n){return console.error("خطأ في البحث عن المدن:",n),[]}},async getHijriDate(r=new Date){const n={1:"محرم",2:"صفر",3:"ربيع الأول",4:"ربيع الثاني",5:"جمادى الأولى",6:"جمادى الآخرة",7:"رجب",8:"شعبان",9:"رمضان",10:"شوال",11:"ذو القعدة",12:"ذو الحجة"};try{const i=r.getTime()-T.gregorian.getTime(),u=Math.floor(i/(1e3*60*60*24));let l=T.hijri.day+u,o=T.hijri.month,c=T.hijri.year;const d=29.5;for(;l>d;)l-=Math.floor(d),o++,o>12&&(o=1,c++);for(;l<=0;)o--,o<1&&(o=12,c--),l+=Math.floor(d);return l=Math.max(1,Math.min(Math.floor(l),30)),{day:l,month:{ar:n[o],en:"",number:o},year:c,designation:{abbreviated:"هـ",expanded:"هجري"}}}catch(i){return console.error("خطأ في حساب التاريخ الهجري:",i),{day:1,month:{ar:n[1],en:"",number:1},year:1446,designation:{abbreviated:"هـ",expanded:"هجري"}}}},saveFavoriteCity(r){try{return r&&r.name&&r.lat&&r.lon?(localStorage.setItem("favoriteCity",JSON.stringify(r)),!0):!1}catch(n){return console.error("خطأ في حفظ المدينة المفضلة:",n),!1}},getFavoriteCity(){try{const r=localStorage.getItem("favoriteCity");if(!r)return null;const n=JSON.parse(r);return n&&n.name&&n.lat&&n.lon?n:null}catch(r){return console.error("خطأ في جلب المدينة المفضلة:",r),null}},formatHijriDate(r){return r?`${r.day} ${r.month.ar} ${r.year}${r.designation.abbreviated}`:""},async convertToHijri(r){return this.getHijriDate(r)}},se={class:"prayer-page"},re={class:"page-header"},ne={class:"container"},oe={class:"date-display"},ie={class:"date-wrapper"},le={class:"gregorian-date"},ce={class:"time-wrapper"},ue={class:"current-time"},de={class:"search-section"},me={class:"container"},he={class:"search-container"},ve={class:"search-results"},fe={key:0,class:"loading-results"},ye={key:1,class:"no-results"},ge={key:2,class:"results-list"},pe=["onMousedown"],_e={class:"city-info"},we={class:"city-name"},De={class:"prayers-section"},$e={class:"container"},Te={class:"prayer-cards"},Ce={class:"prayer-card-content"},Se={class:"prayer-icon"},Me={class:"prayer-info"},be={class:"prayer-name"},xe={class:"prayer-time"},Ee={key:0,class:"remaining-time"},je={key:0,class:"error-toast"},Ne={__name:"PrayerTimesView",setup(r){const n=h(""),i=h([]),u=h(!1),l=h(!1),o=h(null),c=h(""),d=h([]),p=h(""),x=h(""),E=h(""),H=h(""),C={Fajr:{name:"الفجر",icon:"fas fa-sun"},Sunrise:{name:"الشروق",icon:"fas fa-sun"},Dhuhr:{name:"الظهر",icon:"fas fa-sun"},Asr:{name:"العصر",icon:"fas fa-sun"},Maghrib:{name:"المغرب",icon:"fas fa-moon"},Isha:{name:"العشاء",icon:"fas fa-star"}},S=(t,e=3e3)=>{c.value=t,setTimeout(()=>{c.value=""},e)};let w;const U=()=>{if(clearTimeout(w),n.value.length<2){u.value=!1;return}l.value=!0,w=setTimeout(async()=>{try{const t=await _.searchCities(n.value);i.value=t,u.value=!0}catch{S("حدث خطأ في البحث عن المدن")}finally{l.value=!1}},300)},j=async()=>{var t;try{const e=await _.getHijriDate();e&&(p.value=`${e.day||""} ${((t=e.month)==null?void 0:t.ar)||""} ${e.year||""}هـ`.trim())}catch(e){console.error("Error loading Hijri date:",e);const a=new Date;p.value=a.toLocaleDateString("ar-SA",{year:"numeric",month:"long",day:"numeric"})}},N=async t=>{o.value=t,n.value=t.name,u.value=!1,await A(t),_.saveFavoriteCity(t)},A=async t=>{var e;try{l.value=!0;const a=await _.getPrayerTimesByCoordinates(t.lat,t.lon);if(a&&a.timings)V(a.timings),H.value=((e=a.meta)==null?void 0:e.timezone)||"UTC+3",await j();else throw new Error("بيانات مواقيت الصلاة غير صحيحة")}catch{S("حدث خطأ في تحميل مواقيت الصلاة")}finally{l.value=!1}},V=t=>{const e=new Date,a=Object.entries(t).filter(([m])=>C[m]).map(([m,y])=>{const D=new Date(`${e.toDateString()} ${y}`),k=z(D),Q=O(D);return{name:m,arabicName:C[m].name,icon:C[m].icon,time:q(y),isNext:k,isCurrent:Q,remaining:k?J(D):null,timestamp:D.getTime()}});d.value=a.sort((m,y)=>m.timestamp-y.timestamp)},q=t=>{try{return new Date(`2000/01/01 ${t}`).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!0})}catch(e){return console.error("Error formatting time:",e),t}},z=t=>{const e=new Date;return t>e&&!d.value.some(a=>a.isNext&&new Date(`${e.toDateString()} ${a.time}`)<t)},O=t=>{const e=new Date;return t<=e&&!d.value.some(a=>new Date(`${e.toDateString()} ${a.time}`)>e&&new Date(`${e.toDateString()} ${a.time}`)<t)},J=t=>{const a=t-new Date;if(a<=0)return null;const m=Math.floor(a/(1e3*60*60)),y=Math.floor(a%(1e3*60*60)/(1e3*60));return m>0?`متبقي ${m} ساعة و ${y} دقيقة`:`متبقي ${y} دقيقة`};let M;const I=()=>{const t=new Date;x.value=t.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}),E.value=t.toLocaleDateString("ar-SA",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),o.value&&t.getSeconds()===0&&A(o.value)},Y=()=>{setTimeout(()=>{u.value=!1},200)};return K(async()=>{try{await j();const t=_.getFavoriteCity();t&&await N(t),I(),M=setInterval(I,1e3)}catch(t){console.error("Error during component mount:",t),S("حدث خطأ أثناء تحميل البيانات")}}),W(()=>{M&&clearInterval(M),w&&clearTimeout(w)}),(t,e)=>(f(),v("div",se,[s("header",re,[s("div",ne,[e[2]||(e[2]=s("h1",{class:"page-title"},"إن الصلاة كانت على المؤمنين كتابًا موقوتًا.",-1)),s("div",oe,[s("div",ie,[s("div",le,g(E.value),1)]),s("div",ce,[s("div",ue,g(x.value),1)])])])]),s("section",de,[s("div",me,[s("div",he,[s("div",{class:b(["search-box",{"is-active":u.value}])},[e[6]||(e[6]=s("i",{class:"fas fa-search search-icon"},null,-1)),L(s("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>n.value=a),onInput:U,onFocus:e[1]||(e[1]=a=>u.value=!0),onBlur:Y,placeholder:"ابحث عن مدينتك...",class:"search-input"},null,544),[[X,n.value]]),L(s("div",ve,[l.value?(f(),v("div",fe,e[3]||(e[3]=[s("i",{class:"fas fa-spinner fa-spin"},null,-1),$(" جاري البحث... ")]))):i.value.length===0&&n.value?(f(),v("div",ye,e[4]||(e[4]=[s("i",{class:"fas fa-map-marker-alt"},null,-1),$(" لم يتم العثور على نتائج ")]))):(f(),v("div",ge,[(f(!0),v(R,null,B(i.value,a=>(f(),v("div",{key:`${a.lat}-${a.lon}`,onMousedown:m=>N(a),class:"city-item"},[e[5]||(e[5]=s("i",{class:"fas fa-map-marker-alt"},null,-1)),s("div",_e,[s("span",we,g(a.name),1)])],40,pe))),128))]))],512),[[Z,u.value]])],2)])])]),s("section",De,[s("div",$e,[s("div",Te,[(f(!0),v(R,null,B(d.value,a=>(f(),v("div",{key:a.name,class:b(["prayer-card",{"is-next":a.isNext,"is-current":a.isCurrent}])},[s("div",Ce,[s("div",Se,[s("i",{class:b(a.icon)},null,2)]),s("div",Me,[s("h3",be,g(a.arabicName),1),s("div",xe,g(a.time),1),a.remaining?(f(),v("div",Ee,[e[7]||(e[7]=s("i",{class:"fas fa-clock"},null,-1)),$(" "+g(a.remaining),1)])):P("",!0)])])],2))),128))])])]),c.value?(f(),v("div",je,[e[8]||(e[8]=s("i",{class:"fas fa-exclamation-circle"},null,-1)),$(" "+g(c.value),1)])):P("",!0)]))}},ke=G(Ne,[["__scopeId","data-v-b1ed7188"]]);export{ke as default};
