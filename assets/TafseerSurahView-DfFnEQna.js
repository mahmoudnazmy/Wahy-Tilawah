import{_ as M,r as c,o as U,q as j,a as l,i as y,s as T,b as a,h as x,e as F,t as n,w as L,p as P,F as I,d as $,u as R,l as z,f as r,j as m,m as O}from"./index-BtZz1Nt2.js";import{a as E}from"./index-DW_MHI2K.js";const G={class:"tafseer-surah-container"},H={key:0,class:"surah-header"},J={class:"surah-info"},K={class:"meta"},Q={class:"number"},W={class:"type"},X={class:"count"},Y={key:1,class:"loading-state"},Z={key:2,class:"error"},N={class:"error-actions"},ee={key:3,class:"surah-content"},ae={class:"tafseer-selector"},se=["disabled"],te=["value"],ne={class:"ayahs-container"},le={class:"ayah-text"},re={class:"ayah-number"},oe={class:"ayah-actions"},ue=["onClick","disabled"],ie=["onClick","disabled"],ce={key:0,class:"tafseer-content"},de={class:"tafseer-header"},ve={class:"tafseer-actions"},fe=["onClick"],he=["onClick"],pe={__name:"TafseerSurahView",setup(_e){const k=R();z();const u=c(null),f=c(null),p=c(!0),i=c(localStorage.getItem("selectedTafseer")||""),o=c({}),h=c(null),d=c(null),v=c(new Audio),V=[{id:1,identifier:"ar.muyassar",name:"التفسير الميسر",author:"نخبة من العلماء"},{id:2,identifier:"ar.jalalayn",name:"تفسير الجلالين",author:"المحلي والسيوطي"},{id:4,identifier:"ar.qurtubi",name:"تفسير القرطبي",author:"الإمام القرطبي"}],g=async()=>{try{p.value=!0,f.value=null;const s=await E.get(`https://api.alquran.cloud/v1/surah/${k.params.surahNumber}/ar.alafasy`);if(s.data.code===200)u.value=s.data.data,i.value&&await w();else throw new Error("فشل في تحميل السورة")}catch(s){console.error("Error loading surah:",s),f.value="حدث خطأ أثناء تحميل السورة. الرجاء المحاولة مرة أخرى."}finally{p.value=!1}},w=async()=>{try{const s=await S(1);o.value={1:s}}catch(s){console.error("Error loading initial tafseer:",s)}},S=async s=>{try{if(!i.value||h.value===s)return;h.value=s;const e=await E.get(`https://api.alquran.cloud/v1/ayah/${k.params.surahNumber}:${s}/${i.value}`);if(e.data.code===200)return o.value={...o.value,[s]:e.data.data.text},e.data.data.text;throw new Error("فشل في تحميل التفسير")}catch(e){console.error("Error loading ayah tafseer:",e),alert("فشل في تحميل التفسير")}finally{h.value=null}},q=async s=>{try{if(d.value===s){v.value.pause(),d.value=null;return}const e=`https://cdn.islamic.network/quran/audio/128/ar.alafasy/${s}.mp3`;v.value.src=e,await v.value.play(),d.value=s,v.value.onended=()=>{d.value=null}}catch(e){console.error("Error playing audio:",e),alert("فشل في تشغيل الصوت")}},C=async s=>{try{const e=o.value[s];await navigator.clipboard.writeText(e),alert("تم نسخ التفسير بنجاح")}catch{alert("فشل في نسخ التفسير")}},A=s=>{const e=o.value[s],_={title:`تفسير سورة ${u.value.name} - الآية ${s}`,text:e,url:window.location.href};navigator.share?navigator.share(_).catch(t=>console.error("Error sharing:",t)):C(s)},D=()=>{localStorage.setItem("selectedTafseer",i.value),o.value={},i.value&&w()},B=()=>{v.value&&(v.value.pause(),v.value=null)};return U(()=>{g()}),j(B),(s,e)=>{const _=F("router-link");return r(),l("div",G,[u.value&&!f.value?(r(),l("div",H,[T(_,{to:"/tafseer",class:"back-btn"},{default:x(()=>e[1]||(e[1]=[a("i",{class:"fas fa-arrow-right"},null,-1),m(" العودة للسور ")])),_:1}),a("div",J,[a("h1",null,n(u.value.name),1),a("div",K,[a("span",Q,"السورة رقم "+n(u.value.number),1),a("span",W,n(u.value.revelationType==="Meccan"?"مكية":"مدنية"),1),a("span",X,n(u.value.numberOfAyahs)+" آية",1)])])])):y("",!0),p.value?(r(),l("div",Y,e[2]||(e[2]=[a("div",{class:"spinner"},null,-1),a("p",null,"جاري تحميل السورة...",-1)]))):f.value?(r(),l("div",Z,[a("p",null,n(f.value),1),a("div",N,[a("button",{onClick:g,class:"retry-btn"}," إعادة المحاولة "),T(_,{to:"/tafseer",class:"back-link"},{default:x(()=>e[3]||(e[3]=[m(" العودة لقائمة السور ")])),_:1})])])):(r(),l("div",ee,[a("div",ae,[L(a("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>i.value=t),onChange:D,disabled:p.value},[e[4]||(e[4]=a("option",{value:""},"اختر التفسير",-1)),(r(),l(I,null,$(V,t=>a("option",{key:t.identifier,value:t.identifier},n(t.name),9,te)),64))],40,se),[[P,i.value]])]),a("div",ne,[(r(!0),l(I,null,$(u.value.ayahs,t=>(r(),l("div",{key:t.number,class:"ayah-block"},[a("div",le,[a("span",re,n(t.numberInSurah),1),a("p",null,n(t.text),1)]),a("div",oe,[a("button",{onClick:b=>q(t.number),disabled:d.value===t.number,class:"play-btn"},[a("i",{class:O(d.value===t.number?"fas fa-pause":"fas fa-play")},null,2),m(" "+n(d.value===t.number?"إيقاف":"استماع"),1)],8,ue),i.value&&!o.value[t.numberInSurah]?(r(),l("button",{key:0,onClick:b=>S(t.numberInSurah),disabled:h.value===t.numberInSurah,class:"tafseer-btn"},[e[5]||(e[5]=a("i",{class:"fas fa-book-open"},null,-1)),m(" "+n(h.value===t.numberInSurah?"جاري التحميل...":"عرض التفسير"),1)],8,ie)):y("",!0)]),o.value[t.numberInSurah]?(r(),l("div",ce,[a("div",de,[e[8]||(e[8]=a("h3",null,"التفسير",-1)),a("div",ve,[a("button",{onClick:b=>C(t.numberInSurah),title:"نسخ التفسير"},e[6]||(e[6]=[a("i",{class:"fas fa-copy"},null,-1)]),8,fe),a("button",{onClick:b=>A(t.numberInSurah),title:"مشاركة التفسير"},e[7]||(e[7]=[a("i",{class:"fas fa-share"},null,-1)]),8,he)])]),a("p",null,n(o.value[t.numberInSurah]),1)])):y("",!0)]))),128))])]))])}}},ye=M(pe,[["__scopeId","data-v-64d7fbc7"]]);export{ye as default};
