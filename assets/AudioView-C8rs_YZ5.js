import{_ as M,r as l,c as N,o as O,a as r,i as C,b as e,t,j as U,w as F,v as I,F as z,d as H,m as R,u as Q,f as u}from"./index-BtZz1Nt2.js";import{q as _}from"./quranService-Bxddy8Q8.js";import"./index-DW_MHI2K.js";const Y={class:"audio-container"},G={key:0,class:"loading-state"},J={key:1,class:"error-state"},K={key:2,class:"content-wrapper"},W={class:"hero-section"},X={class:"hero-content"},Z={class:"surah-header"},ee={class:"surah-info"},se={class:"surah-details"},ae={class:"search-section"},oe={class:"search-box"},le={class:"reciters-section"},te={class:"reciters-grid"},ne={class:"reciter-content"},ie={class:"reciter-info"},re={class:"reciter-actions"},ue=["onClick","disabled","title"],de=["onClick","disabled"],ce={key:0,class:"progress-bar"},ve={class:"player-info"},pe={class:"now-playing"},fe={class:"player-controls"},ye=["src"],me={__name:"AudioView",setup(he){const w=Q(),d=l(null),b=l([]),h=l(""),n=l(null),g=l(""),c=l(null),v=l(!1),k=l(!0),p=l(!1),f=l(null),A=l(0),D=N(()=>{if(!h.value)return b.value;const a=h.value.toLowerCase();return b.value.filter(s=>s.name.toLowerCase().includes(a)||s.rewaya&&s.rewaya.toLowerCase().includes(a))}),E=async()=>{try{k.value=!0,f.value=null;const[a,s]=await Promise.all([_.getSurah(w.params.id),_.getReciters()]);d.value=a,b.value=s}catch(a){console.error("Error loading initial data:",a),f.value="حدث خطأ أثناء تحميل البيانات. الرجاء المحاولة مرة أخرى."}finally{k.value=!1}},T=async a=>{try{p.value=!0,n.value=a;const s=_.getReciterSurah(a,w.params.id);if(!(await fetch(s,{method:"HEAD"})).ok)throw new Error("تعذر تحميل الملف الصوتي");g.value=s,c.value&&(await c.value.load(),await c.value.play())}catch(s){console.error("Error playing audio:",s),f.value="حدث خطأ أثناء تحميل الملف الصوتي. الرجاء المحاولة مرة أخرى."}finally{p.value=!1}},V=async a=>{try{p.value=!0;const s=_.getReciterSurah(a,w.params.id),y=await fetch(s);if(!y.ok)throw new Error("تعذر تحميل الملف الصوتي");const o=await y.blob(),m=window.URL.createObjectURL(o),i=document.createElement("a");i.href=m,i.download=`سورة-${d.value.name}-${a.name}.mp3`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(m)}catch(s){console.error("Error downloading audio:",s),f.value="حدث خطأ أثناء تحميل الملف. الرجاء المحاولة مرة أخرى."}finally{p.value=!1}},S=()=>v.value=!0,$=()=>v.value=!1,j=()=>{v.value=!1,n.value=null},q=a=>{c.value&&(A.value=c.value.currentTime/c.value.duration*100)};return O(()=>{E()}),(a,s)=>{var y;return u(),r("div",Y,[k.value?(u(),r("div",G,s[1]||(s[1]=[e("div",{class:"loading-spinner"},[e("i",{class:"fas fa-spinner fa-spin"})],-1),e("p",null,"جاري تحميل البيانات...",-1)]))):f.value?(u(),r("div",J,[s[3]||(s[3]=e("div",{class:"error-icon"},[e("i",{class:"fas fa-exclamation-circle"})],-1)),e("p",null,t(f.value),1),e("button",{onClick:E,class:"retry-btn"},s[2]||(s[2]=[e("i",{class:"fas fa-redo"},null,-1),U(" إعادة المحاولة ")]))])):d.value?(u(),r("div",K,[e("section",W,[e("div",X,[e("div",Z,[e("div",ee,[e("h1",null,t(d.value.name),1),e("p",se," عدد الآيات: "+t(d.value.numberOfAyahs)+" | "+t(d.value.revelationType==="Meccan"?"مكية":"مدنية"),1)])])]),s[4]||(s[4]=e("div",{class:"hero-pattern"},null,-1))]),e("div",ae,[e("div",oe,[F(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=o=>h.value=o),placeholder:"ابحث عن القارئ...",class:"search-input"},null,512),[[I,h.value]]),s[5]||(s[5]=e("i",{class:"fas fa-search search-icon"},null,-1))])]),e("div",le,[s[8]||(s[8]=e("h2",null,[e("i",{class:"fas fa-microphone-alt"}),U(" اختر القارئ ")],-1)),e("div",te,[(u(!0),r(z,null,H(D.value,o=>{var m,i,L,P,x;return u(),r("div",{key:o.id,class:R(["reciter-card",{active:((m=n.value)==null?void 0:m.id)===o.id}])},[e("div",ne,[e("div",ie,[e("h3",null,t(o.name),1),e("p",null,t(o.rewaya),1)]),e("div",re,[e("button",{class:"action-btn play-btn",onClick:B=>T(o),disabled:p.value,title:v.value&&((i=n.value)==null?void 0:i.id)===o.id?"إيقاف":"استماع"},[e("i",{class:R(v.value&&((L=n.value)==null?void 0:L.id)===o.id?"fas fa-pause":"fas fa-play")},null,2),e("span",null,t(v.value&&((P=n.value)==null?void 0:P.id)===o.id?"إيقاف":"استماع"),1)],8,ue),e("button",{class:"action-btn download-btn",onClick:B=>V(o),disabled:p.value,title:"تحميل"},s[6]||(s[6]=[e("i",{class:"fas fa-download"},null,-1),e("span",null,"تحميل",-1)]),8,de)])]),p.value&&((x=n.value)==null?void 0:x.id)===o.id?(u(),r("div",ce,s[7]||(s[7]=[e("div",{class:"progress-inner"},null,-1)]))):C("",!0)],2)}),128))])]),g.value?(u(),r("div",{key:0,class:R(["audio-player",{"is-playing":v.value}])},[e("div",ve,[e("div",pe,[s[9]||(s[9]=e("i",{class:"fas fa-music"},null,-1)),e("span",null,t((y=n.value)==null?void 0:y.name)+" - سورة "+t(d.value.name),1)]),e("div",fe,[e("audio",{ref_key:"audioPlayer",ref:c,src:g.value,onPlay:S,onPause:$,onEnded:j,onTimeupdate:q,controls:"",class:"custom-audio"}," Your browser does not support the audio element. ",40,ye)])])],2)):C("",!0)])):C("",!0)])}}},ge=M(me,[["__scopeId","data-v-13d5335e"]]);export{ge as default};
